function Init(n){SVGRoot=$(n)[0];$(SVGRoot).on("dragover",Drag);$(SVGRoot).on("dragend",Drop);TrueCoords=SVGRoot.createSVGPoint();GrabPoint=$(".board > svg")[0].createSVGPoint()}function Grab(n){var t,i;console.log("grab");t=n.target;GetTrueCoords(n);console.log($(".selected-add").length);console.log($(".current-player").length);console.log($(".current-player").hasClass($(t).attr("player")));console.log(t.id.startsWith("piece"));!DragTarget&&$(".current-player").length===1&&$(".current-player").hasClass($(t).attr("player"))&&t.id.startsWith("piece")&&($(".selected").removeClass("selected"),$("#"+t.id).addClass("selected drag"),GrabScreenCoords={x:n.screenX,y:n.screenY},GrabClientCoords={x:n.clientX,y:n.clientY},console.log(n),t=t.closest("g"),DragTarget=t,DragTarget&&$(".board svg")[0].appendChild(DragTarget),DragTarget.setAttributeNS(null,"pointer-events","none"),i=DragTarget.getCTM(),GrabPoint.x=TrueCoords.x-Number(i.e),GrabPoint.y=TrueCoords.y-Number(i.f))}function Drag(n){if(console.log("drag"),DragTarget){GetTrueCoords(n);console.log(TrueCoords);console.log(GrabPoint);var t=(TrueCoords.x-GrabPoint.x)/$(".board > svg")[0].getBoundingClientRect().width*50,i=(TrueCoords.y-GrabPoint.y)/$(".board > svg")[0].getBoundingClientRect().height*50;$(DragTarget)[0].setAttribute("transform","translate("+t+","+i+")")}}function Drop(n){var l,t,w,a,f,u,i,c,v,e,o;if(console.log("drop"),console.log(DragTarget),DragTarget&&$(".selected-add").length===0){if(l=n.target,n.type==="dragend"){var w={x:n.screenX,y:n.screenY},t={x:GrabClientCoords.x+(n.screenX-GrabScreenCoords.x),y:GrabClientCoords.y+(n.screenY-GrabScreenCoords.y)},a=$(".square"),b=$(".board").attr("id")!=="board-editor-board-container";for(f=0;f<a.length;f++)if(u=a[f],i=u.getBoundingClientRect(),i.left<=t.x&&i.right>=t.x&&i.top<=t.y&&i.bottom>=t.y){l=u;var y=u.id.replace("square",""),s=parseInt(y[0]),h=parseInt(y[1]);b?(boardClick(s,h),$(DragTarget).removeAttr("pointer-events")):$(l).hasClass("drop-target")?($(DragTarget).removeAttr("transform"),$(DragTarget).find("svg").attr("x",$(l).attr("x")),$(DragTarget).find("svg").attr("y",$(l).attr("y")),$(DragTarget).removeAttr("pointer-events")):$(DragTarget).remove();break}}DragTarget=null;return}if($(".selected-add").length!==0)for(console.log("here"),n.type==="dragend"?(w={x:n.screenX,y:n.screenY},t={x:GrabClientCoords.x+(n.screenX-GrabScreenCoords.x),y:GrabClientCoords.y+(n.screenY-GrabScreenCoords.y)}):t={x:n.clientX,y:n.clientY},a=$(".square"),f=0;f<a.length;f++)if(u=a[f],i=u.getBoundingClientRect(),i.left<=t.x&&i.right>=t.x&&i.top<=t.y&&i.bottom>=t.y){console.log("bound");switch($(".selected-add").attr("id")){case"piece-black-checker":c="Black";v="Checker";break;case"piece-black-king":c="Black";v="King";break;case"piece-white-checker":c="White";v="Checker";break;case"piece-white-king":c="White";v="King"}var y=u.id.replace("square",""),s=parseInt(y[0]),h=parseInt(y[1]),p=document.createElementNS("http://www.w3.org/2000/svg","g"),r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttribute("id","svg"+s+h);r.setAttribute("onclick","pieceClick("+s+h+")");r.setAttribute("height","12.5%");r.setAttribute("width","12.5%");r.setAttribute("style","fill:none");r.setAttribute("x",""+$(u).attr("x"));r.setAttribute("y",""+$(u).attr("y"));e=document.createElementNS("http://www.w3.org/2000/svg","image");e.setAttribute("id","piece"+s+h);e.setAttribute("player",c);e.setAttribute("height","100%");e.setAttribute("width","100%");e.setAttribute("href","/images/SteelTheme/"+c+v+".png");o=document.createElementNS("http://www.w3.org/2000/svg","rect");o.setAttribute("id","rect"+s+h);o.setAttribute("class","selected-piece-highlight");o.setAttribute("height","100%");o.setAttribute("width","100%");o.setAttribute("style","fill:none; stroke:goldenrod");r.appendChild(e);r.appendChild(o);p.appendChild(r);$("#piece"+s+h).closest("g").first().remove();$(".board > svg")[0].appendChild(p);$(".selected-add").removeClass("selected-add");break}}function GetTrueCoords(n){var t=SVGRoot.currentScale,i=SVGRoot.currentTranslate;TrueCoords.x=(n.clientX-i.x)/t;TrueCoords.y=(n.clientY-i.y)/t}function BoardEditorInit(){$("*").on("mousedown",BoardEditorGrab);$("*").on("dragend",BoardEditorDrop)}function BoardEditorGrab(n){var t=n.target;!BoardEditorDragTarget&&n.target.id.startsWith("piece")&&($(t).hasClass("selected-add")||$(".selected-add").removeClass("selected-add"),$(".selected").removeClass("selected"),$(".drag").removeClass("drag"),$("#"+t.id).addClass("selected drag"),BoardEditorGrabScreenCoords={x:n.screenX,y:n.screenY},BoardEditorGrabClientCoords={x:n.clientX,y:n.clientY},BoardEditorDragTarget=t,BoardEditorGrabPoint={x:n.clientX,y:n.clientY})}function BoardEditorDrop(n){console.log(BoardEditorDragTarget);console.log($(".selected-add").length===0);BoardEditorDragTarget&&$(".selected-add").length===0?MovePiece(n):$(".selected-add").length!==0&&AddPieceToBoard(n);BoardEditorDragTarget=null}function MovePiece(n){var e={x:BoardEditorGrabClientCoords.x+(n.screenX-BoardEditorGrabScreenCoords.x),y:BoardEditorGrabClientCoords.y+(n.screenY-BoardEditorGrabScreenCoords.y)},f=GetBoundingSquare(e);if(f){var r=f.id.replace("square",""),u=n.target.id.replace("piece",""),t=parseInt(r[0]),i=parseInt(r[1]),o=parseInt(u[0]),s=parseInt(u[1]);if(r===u)return;$("#piece"+t+i).remove();$(BoardEditorDragTarget).attr("id","piece"+t+i);$(BoardEditorDragTarget).attr("onmousedown","pieceClick("+t+", "+i+")");$(BoardEditorDragTarget).css("grid-row",""+(t+1));$(BoardEditorDragTarget).css("grid-column",""+(i+1))}else $(BoardEditorDragTarget).remove()}function AddPieceToBoard(n){var f,h,e,t,i,s;if(n.type==="dragend"?(h={x:n.screenX,y:n.screenY},f={x:BoardEditorGrabClientCoords.x+(n.screenX-BoardEditorGrabScreenCoords.x),y:BoardEditorGrabClientCoords.y+(n.screenY-BoardEditorGrabScreenCoords.y)}):f={x:n.clientX,y:n.clientY},e=GetBoundingSquare(f),e){switch($(".selected-add").attr("id")){case"piece-black-checker":t="Black";i="Checker";break;case"piece-black-king":t="Black";i="King";break;case"piece-white-checker":t="White";i="Checker";break;case"piece-white-king":t="White";i="King"}var o=e.id.replace("square",""),r=parseInt(o[0]),u=parseInt(o[1]);$("#piece"+r+u).remove();s='<img id="piece'+r+u+'" class="piece" onmousedown="pieceClick('+r+", "+u+')" src="/images/SteelTheme/'+t+i+'.png" style="grid-row: '+(r+1)+"; grid-column: "+(u+1)+'" />';$(".board").append(s);$(".selected-add").removeClass("selected-add")}}function GetBoundingSquare(n){for(var r,t,u=$(".drop-target"),i=0;i<u.length;i++)if(r=u[i],t=r.getBoundingClientRect(),t.left<=n.x&&t.right>=n.x&&t.top<=n.y&&t.bottom>=n.y)return r;return null}function getAdjustedIndex(n){switch($(".board").attr("orientation").toLowerCase()){case"black":return 7-n;case"white":return n}}function pieceClick(n,t){$(".selected").removeClass("selected");$("#piece"+n+t).addClass("selected");$(".selected").closest("rect").css("stroke-width","1")}function boardClick(n,t){var o,s;if($(".selected").length!==0){var e=$(".selected").attr("id").replace("piece",""),i=getAdjustedIndex(parseInt(e[0])),r=getAdjustedIndex(parseInt(e[1])),u=getAdjustedIndex(n),f=getAdjustedIndex(t);if(i===u||r===f){$(".selected").closest("g").removeAttr("transform");$(".selected").removeClass("drag");return}o=6.25*(r-f);s=6.25*(i-u);$(".selected").closest("g")[0].setAttributeNS(null,"transform","translate("+o+","+s+")");$.ajax("/Board/MovePiece",{data:{id:$(".board").attr("id"),start:{row:i,column:r},end:{row:u,column:f}},dataType:"html",method:"POST",error:function(){$(".selected").closest("g").removeAttr("transform");$(".selected").removeClass("drag")}})}}function undo(){$.ajax("/Board/Undo",{data:{id:$(".board").attr("id")},dataType:"html",method:"POST"})}function resign(){$.ajax("/Board/Resign",{data:{id:$(".board").attr("id")},dataType:"html",method:"POST"})}function joinGame(){$.ajax("/Board/Join",{data:{id:$(".board").attr("id")},dataType:"html",method:"POST",success:function(n){$(".board")[0].outerHTML=n;Init(".board svg")}})}function displayGame(n){$.ajax("/Board/DisplayGame",{data:{moveID:n,orientation:$(".board").attr("orientation")},dataType:"html",method:"POST",success:function(n){$(".board")[0].outerHTML=n;Init(".board svg")}})}function flip(){switch($(".board").attr("orientation").toLowerCase()){case"black":$(".board").attr("orientation","White");break;case"white":$(".board").attr("orientation","Black")}var n=$(".moves li input:checked");n.length===0&&(n=$(".moves li input:last"));$.ajax("/Board/Orientate",{data:{id:$(".board").attr("id"),moveID:n.length===0?"":n.attr("id"),orientation:$(".board").attr("orientation")},dataType:"html",method:"POST",success:function(n){$(".board")[0].outerHTML=n;Init(".board svg")}})}function getCookie(n){var r=document.cookie.split(";"),u,t,i;for(u in r)if((t=r[u],t.indexOf("=")!==-1)&&(i=t.split("="),i[0].trim()===n))return i[1].trim();return""}function updateBoardEditor(){$.ajax("/BoardEditor/GetBoard",{data:{variant:$("#variant-board-editor").val(),position:$("#position-board-editor").val()},dataType:"html",method:"POST",success:function(n){$(".board")[0].outerHTML=n}})}function connectToSignalR(){var n=new signalR.HttpConnection("/signalRHub");signalRConnection=new signalR.HubConnection(n);signalRConnection.on("UpdateBoard",function(n,t,i){if($(".board").attr("id").toLowerCase()===n.toLowerCase()){switch($(".board").attr("orientation").toLowerCase()){case"black":$(".board")[0].outerHTML=t;break;case"white":$(".board")[0].outerHTML=i}Init(".board svg")}});signalRConnection.on("UpdateMoves",function(n){$(".moves")[0].outerHTML=n});signalRConnection.on("UpdateOpponentState",function(n,t){switch(t){case"WhiteWin":$(".player-to-move").html("White Won");$(".win-status").html("1 - 0");break;case"BlackWin":$(".player-to-move").html("Black Won");$(".win-status").html("0 - 1");break;case"Drawn":$(".player-to-move").html("Game Drawn");$(".win-status").html("½ - ½");break;case"InProgress":$(".player-to-move").html(n+"'s Turn");$(".win-status").html("*")}});signalRConnection.on("SetAttribute",function(n,t,i){$("#"+n).attr(t,i)});signalRConnection.on("RemoveAttribute",function(n,t){$("#"+n).removeAttr(t)});signalRConnection.on("AddClass",function(n,t){$("#"+n).addClass(t)});signalRConnection.on("RemoveClass",function(n,t){$("#"+n).removeClass(t)});signalRConnection.on("SetHtml",function(n,t){$(""+n).html(t)});signalRConnection.start().then(function(){var n=getCookie("playerID");n===""?signalRConnection.invoke("GetNewPlayerID").then(function(n){document.cookie+=(document.cookie.trim()===""?"":";")+"playerID="+n+";path=/";signalRConnection.invoke("MapPlayerConnection",n)}):signalRConnection.invoke("MapPlayerConnection",n)})}var signalRConnection;(function(n){"use strict";typeof define=="function"&&define.amd?define(["jquery"],n):typeof module!="undefined"&&module.exports?module.exports=n(require("jquery")):n(jQuery)})(function(n){var o=-1,r=-1,i=function(n){return parseFloat(n)||0},s=function(t){var f=1,e=n(t),u=null,r=[];return e.each(function(){var t=n(this),e=t.offset().top-i(t.css("margin-top")),o=r.length>0?r[r.length-1]:null;o===null?r.push(t):Math.floor(Math.abs(u-e))<=f?r[r.length-1]=o.add(t):r.push(t);u=e}),r},u=function(t){var i={byRow:!0,property:"height",target:null,remove:!1,subtractFromTarget:0};return typeof t=="object"?n.extend(i,t):(typeof t=="boolean"?i.byRow=t:t==="remove"&&(i.remove=!0),i)},t=n.fn.matchHeight=function(i){var r=u(i),f;return r.remove?(f=this,this.css(r.property,""),n.each(t._groups,function(n,t){t.elements=t.elements.not(f)}),this):this.length<=1&&!r.target?this:(t._groups.push({elements:this,options:r}),t._apply(this,r),this)},f,e;t.version="master";t._groups=[];t._throttle=80;t._maintainScroll=!1;t._beforeUpdate=null;t._afterUpdate=null;t._rows=s;t._parse=i;t._parseOptions=u;t._apply=function(r,f){var e=u(f),o=n(r),c=[o],l=n(window).scrollTop(),a=n("html").outerHeight(!0),h=o.parents().filter(":hidden");return h.each(function(){var t=n(this);t.data("style-cache",t.attr("style"))}),h.css("display","block"),e.byRow&&!e.target&&(o.each(function(){var i=n(this),t=i.css("display");t!=="inline-block"&&t!=="flex"&&t!=="inline-flex"&&(t="block");i.data("style-cache",i.attr("style"));i.css({display:t,"padding-top":"0","padding-bottom":"0","margin-top":"0","margin-bottom":"0","border-top-width":"0","border-bottom-width":"0",height:"100px",overflow:"hidden"})}),c=s(o),o.each(function(){var t=n(this);t.attr("style",t.data("style-cache")||"")})),n.each(c,function(t,r){var u=n(r),f=0;if(e.target)f=e.target.outerHeight(!1);else{if(e.byRow&&u.length<=1){u.css(e.property,"");return}u.each(function(){var t=n(this),u=t.attr("style"),i=t.css("display"),r;i!=="inline-block"&&i!=="flex"&&i!=="inline-flex"&&(i="block");r={display:i};r[e.property]="";t.css(r);t.outerHeight(!1)>f&&(f=t.outerHeight(!1));u?t.attr("style",u):t.css("display","")})}u.each(function(){var t=n(this),r=0;e.target&&t.is(e.target)||(t.css("box-sizing")!=="border-box"&&(r+=i(t.css("border-top-width"))+i(t.css("border-bottom-width")),r+=i(t.css("padding-top"))+i(t.css("padding-bottom"))),t.css(e.property,f-r-e.subtractFromTarget+"px"))})}),h.each(function(){var t=n(this);t.attr("style",t.data("style-cache")||null)}),t._maintainScroll&&n(window).scrollTop(l/a*n("html").outerHeight(!0)),this};t._applyDataApi=function(){var t={};n("[data-match-height], [data-mh]").each(function(){var i=n(this),r=i.attr("data-mh")||i.attr("data-match-height");t[r]=r in t?t[r].add(i):i});n.each(t,function(){this.matchHeight(!0)})};f=function(i){t._beforeUpdate&&t._beforeUpdate(i,t._groups);n.each(t._groups,function(){t._apply(this.elements,this.options)});t._afterUpdate&&t._afterUpdate(i,t._groups)};t._update=function(i,u){if(u&&u.type==="resize"){var e=n(window).width();if(e===o)return;o=e}i?r===-1&&(r=setTimeout(function(){f(u);r=-1},t._throttle)):f(u)};n(t._applyDataApi);e=n.fn.on?"on":"bind";n(window)[e]("load",function(n){t._update(!1,n)});n(window)[e]("resize orientationchange",function(n){t._update(!0,n)})});var SVGRoot=null,TrueCoords=null,GrabPoint=null,DragTarget=null,DragEnded=!1,GrabScreenCoords=null,GrabClientCoords=null;var BoardEditorTrueCoords=null,BoardEditorGrabPoint=null,BoardEditorDragTarget=null,BoardEditorGrabScreenCoords=null,BoardEditorGrabClientCoords=null;BoardEditorInit();connectToSignalR();